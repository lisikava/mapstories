<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE-edge">
    <meta name="viewpoint" content="width=device-width, initial-scale=1.0">
    <title>Map Stories</title>
    <!-- Include leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""/>
     <!-- Make sure you put this AFTER Leaflet's CSS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""></script>

    <link rel="stylesheet" href="style.css">  

</head>

<body>
    <nav>
        <div class="lasso">
            <div class="lasso-text">
              Search
            </div>
            <div class="lasso-wrap">
              <div class="lasso-triangle">
              </div>
              <svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="58px" height="58px" viewBox="0 0 16 16" preserveAspectRatio="none">
                <circle cx="8" cy="8" r="6.215" transform="rotate(90 8 8)"></circle>
                <image href="https://uxwing.com/wp-content/themes/uxwing/download/user-interface/search-icon.svg" x="5.2" y="5.5" width="6" height="6", fill="#de7813" />
              </svg>
             </div>
            <div class="lasso-border">
            </div>
          </div>
          
    </nav>
    <div id="map"></div>
</body>

<script>
    var map = L.map('map', {
        center: [50.065870, 19.934727],
        zoom: 12,
        zoomControl: false,
        attributionControl: false
    });

    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
        maxZoom: 19,
    }).addTo(map);

    const pin_icon = L.icon({
        iconUrl: './assets/pin-3.svg',
        iconSize: [40, 40],
    });

    let pins = [];

    map.on("click", function(e){
        const pinDescription = `
            <div class="popup-from">
                <textarea id="pin-description" placeholder="Enter description here"></textarea><br>
                <button id="pin-submit-button">Submit</button>
            </div>    
        `;

        var temp_pin = new L.marker(
            [e.latlng.lat, e.latlng.lng],{
                icon: pin_icon,}
        ).addTo(map)
        .bindPopup(pinDescription)
        .openPopup();

        const submitButton= document.getElementById('pin-submit-button');
            if (submitButton){
                submitButton.onclick = function() {
                const pin_description = document.getElementById('pin-description').value;
                
                if (pin_description.trim() === ''){
                    alert('Description cannot be empty!');
                    return;
                }
                temp_pin.closePop();

                const new_pin = new L.marker(
                    [e.latlng.lat, e.latlng.lng],{
                        icon: pin_icon,
                        title: pin_description,
                        clickable: true,
                    }).addTo(map)
                    .bindPopup(pin_description)
                    .on('mouseover', function(){
                        new_pin.openPopup();
                    }) 
                    .on('mouseout', function() {
                        this.closePopup();
                    });

                    pins.push(new_pin);
                    document.getElementById('pin-description').value = '';
            };
        }    
    });
</script>    
</html>